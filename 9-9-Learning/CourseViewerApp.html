<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CourseViewerApp â€¢ Warm Sunset Glass</title>
    <style>
      :root {
        --bg1: #ff7e5f;
        --bg2: #feb47b;
        --accent: #ff9a4d;
        --glass-light: rgba(255, 255, 255, 0.2);
        --glass-dark: rgba(30, 20, 10, 0.55);
        --text-light: #fff6f0;
        --text-dark: #2c2c2c;
        --shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        --highlight: rgba(255, 180, 100, 0.25);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(135deg, var(--bg1), var(--bg2));
        height: 100vh;
        display: flex;
        flex-direction: column;
        color: var(--text-light);
        overflow: hidden;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--glass-dark);
        backdrop-filter: blur(10px);
        padding: 8px 14px;
        flex-shrink: 0;
        box-shadow: var(--shadow);
        border-bottom: 1px solid var(--highlight);
      }
      header h1 {
        margin: 0;
        font-size: 1.2em;
        color: var(--accent);
      }
      header button {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.3em;
        cursor: pointer;
      }
      #app-container {
        flex: 1;
        display: flex;
        min-height: 0;
        overflow: hidden;
      }
      #sidebar {
        width: 260px;
        background: var(--glass-light);
        backdrop-filter: blur(14px);
        border-right: 2px solid var(--highlight);
        padding: 10px;
        color: var(--text-dark);
        font-weight: 500;
        overflow-y: auto;
        box-shadow: var(--shadow);
        transition: width 0.3s ease;
      }
      #sidebar.hidden {
        width: 0;
        padding: 0;
        overflow: hidden;
      }
      .folder {
        margin-left: 8px;
      }
      .folder > summary {
        list-style: none;
        cursor: pointer;
        padding: 4px 6px;
        border-radius: 6px;
      }
      .folder > summary:hover {
        background: var(--highlight);
        color: #fff;
      }
      .folder summary::-webkit-details-marker {
        display: none;
      }
      .file-btn {
        display: block;
        text-align: left;
        margin: 2px 0 2px 16px;
        padding: 5px 7px;
        border: none;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        cursor: pointer;
        color: #2a1a1a;
        width: calc(100%-20px);
        font-size: 0.9em;
      }
      .file-btn:hover {
        background: var(--accent);
        color: #fff;
      }
      .file-btn.active {
        background: var(--accent);
        color: #fff;
      }

      #main {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--glass-dark);
        backdrop-filter: blur(12px);
        color: var(--text-light);
        min-height: 0;
      }
      #viewer-header {
        flex-shrink: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 12px;
        background: var(--glass-dark);
        border-bottom: 1px solid var(--highlight);
        box-shadow: var(--shadow);
      }
      #viewer-header h2 {
        font-size: 0.95em;
        margin: 0;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
      }
      #viewer {
        flex: 1;
        overflow: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 12px;
      }
      footer {
        flex-shrink: 0;
        text-align: center;
        padding: 8px;
        font-size: 0.85em;
        background: var(--glass-dark);
        color: #fff;
        border-top: 1px solid var(--highlight);
        box-shadow: var(--shadow);
      }
      #nav-buttons button {
        margin: 0 3px;
        padding: 5px 10px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        font-size: 0.85em;
        box-shadow: var(--shadow);
      }
      video {
        max-width: 100%;
        max-height: 75vh;
        border-radius: 10px;
        box-shadow: var(--shadow);
      }
      .cc-toggle {
        margin-top: 8px;
        padding: 4px 10px;
        border: none;
        border-radius: 6px;
        background: var(--accent);
        color: #fff;
        cursor: pointer;
        font-size: 0.85em;
        box-shadow: var(--shadow);
        transition: 0.3s ease;
      }
      .cc-toggle.active {
        background: #ffd59f;
        color: #3a2a1a;
        box-shadow: 0 0 10px rgba(255, 180, 100, 0.7);
      }
      @media (max-height: 750px) {
        header h1 {
          font-size: 1.05em;
        }
        #viewer-header h2 {
          font-size: 0.9em;
        }
        #nav-buttons button {
          font-size: 0.8em;
          padding: 4px 8px;
        }
        video {
          max-height: 70vh;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <button id="menu-btn">â˜°</button>
      <h1>CourseViewerApp â€¢ Warm Sunset Glass</h1>
      <button id="reload-btn">ðŸ”„</button>
    </header>

    <div id="app-container">
      <div id="sidebar">
        <input
          type="file"
          id="folderPicker"
          webkitdirectory
          directory
          multiple
        />
        <div id="sections"></div>
      </div>

      <div id="main">
        <div id="viewer-header">
          <h2 id="viewer-title">Select a lesson</h2>
          <div id="nav-buttons">
            <button id="prevBtn" disabled>Prev</button>
            <button id="nextBtn" disabled>Next</button>
          </div>
        </div>
        <div id="viewer">
          <p style="opacity: 0.8; text-align: center">
            ðŸ“‚ Choose a folder to begin learning.
          </p>
        </div>
        <footer>Â© 2025 CourseViewerApp â€¢ Warm Sunset Glass ðŸŒ‡</footer>
      </div>
    </div>

    <script>
      const folderPicker = document.getElementById("folderPicker");
      const sectionsDiv = document.getElementById("sections");
      const viewer = document.getElementById("viewer");
      const viewerTitle = document.getElementById("viewer-title");
      const menuBtn = document.getElementById("menu-btn");
      const sidebar = document.getElementById("sidebar");
      const reloadBtn = document.getElementById("reload-btn");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      let allFiles = [],
        flatLessons = [],
        currentIndex = -1;
      const videoExts = ["mp4", "webm", "ogg", "mov", "mkv", "avi", "flv"];

      function naturalSort(a, b) {
        return a.localeCompare(b, undefined, {
          numeric: true,
          sensitivity: "base",
        });
      }

      folderPicker.addEventListener("change", (e) => {
        allFiles = Array.from(e.target.files);

        // ðŸ”¥ Hide .srt, .vtt, and .DS_Store from sidebar
        const visibleFiles = allFiles.filter(
          (f) => !f.name.match(/\.(vtt|srt)$/i) && f.name !== ".DS_Store"
        );

        flatLessons = [];
        const tree = buildTree(visibleFiles);
        sectionsDiv.innerHTML = "";
        sectionsDiv.appendChild(renderTree(tree));
      });

      function buildTree(files) {
        const root = {};
        files.forEach((file) => {
          const parts = file.webkitRelativePath.split("/");
          parts.reduce((acc, part, idx) => {
            if (idx === parts.length - 1) {
              acc.files = acc.files || [];
              acc.files.push(file);
            } else {
              acc.folders = acc.folders || {};
              acc.folders[part] = acc.folders[part] || {};
            }
            return acc.folders ? acc.folders[part] || acc : acc;
          }, root);
        });
        return root;
      }

      function renderTree(node) {
        const container = document.createElement("div");
        const folderNames = node.folders
          ? Object.keys(node.folders).sort(naturalSort)
          : [];
        folderNames.forEach((name) => {
          const details = document.createElement("details");
          details.classList.add("folder");
          const summary = document.createElement("summary");
          summary.textContent = "ðŸ“ " + name;
          details.appendChild(summary);
          details.appendChild(renderTree(node.folders[name]));
          container.appendChild(details);
        });
        if (node.files) {
          node.files
            .sort((a, b) => naturalSort(a.name, b.name))
            .forEach((file) => {
              const btn = document.createElement("button");
              btn.textContent = file.name;
              btn.classList.add("file-btn");
              btn.onclick = (e) => loadLesson(file, e);
              container.appendChild(btn);
              flatLessons.push(file);
            });
        }
        return container;
      }

      function findSubtitle(videoFile) {
        const base = videoFile.name.replace(/\.[^/.]+$/, "");
        return allFiles.find(
          (f) => f.name.startsWith(base) && /\.(vtt|srt)$/i.test(f.name)
        );
      }

      function srtToVtt(srt) {
        return (
          "WEBVTT\n\n" +
          srt
            .replace(/\r+/g, "")
            .replace(/^\s+|\s+$/g, "")
            .split("\n")
            .map((l) => l.replace(/(\d+):(\d+):(\d+),(\d+)/g, "$1:$2:$3.$4"))
            .join("\n")
        );
      }

      function loadLesson(file, event) {
        currentIndex = flatLessons.indexOf(file);
        document
          .querySelectorAll(".file-btn")
          .forEach((b) => b.classList.remove("active"));
        if (event && event.target) event.target.classList.add("active");
        viewerTitle.textContent = file.name;
        const ext = file.name.split(".").pop().toLowerCase();

        if (videoExts.includes(ext)) {
          const sub = findSubtitle(file);
          if (sub) {
            const reader = new FileReader();
            reader.onload = (e) => {
              let subURL;
              if (sub.name.endsWith(".srt")) {
                const blob = new Blob([srtToVtt(e.target.result)], {
                  type: "text/vtt",
                });
                subURL = URL.createObjectURL(blob);
              } else subURL = URL.createObjectURL(sub);

              viewer.innerHTML = `<div style="text-align:center;">
          <video id="video" controls autoplay>
            <source src="${URL.createObjectURL(file)}" type="video/${ext}">
            <track src="${subURL}" kind="subtitles" srclang="en" label="English" default>
          </video>
          <button class="cc-toggle" id="ccBtn">CC</button>
        </div>`;

              const v = document.getElementById("video");
              const track = v.textTracks[0];
              if (track) track.mode = "hidden";
              const ccBtn = document.getElementById("ccBtn");
              ccBtn.onclick = () => {
                if (!track) return;
                const isOn = track.mode === "showing";
                track.mode = isOn ? "hidden" : "showing";
                ccBtn.classList.toggle("active", !isOn);
              };
            };
            reader.readAsText(sub);
          } else {
            viewer.innerHTML = `<video controls autoplay>
        <source src="${URL.createObjectURL(file)}" type="video/${ext}">
      </video>`;
          }
        } else if (ext === "pdf") {
          viewer.innerHTML = `<embed src="${URL.createObjectURL(
            file
          )}" type="application/pdf" width="100%" style="height:80vh;"/>`;
        } else {
          const r = new FileReader();
          r.onload = (e) =>
            (viewer.innerHTML = `<pre style="white-space:pre-wrap;color:#fff;">${e.target.result}</pre>`);
          r.readAsText(file);
        }
        prevBtn.disabled = currentIndex <= 0;
        nextBtn.disabled = currentIndex >= flatLessons.length - 1;
      }

      prevBtn.onclick = () => {
        if (currentIndex > 0)
          loadLesson(flatLessons[currentIndex - 1], {
            target: findBtn(currentIndex - 1),
          });
      };
      nextBtn.onclick = () => {
        if (currentIndex < flatLessons.length - 1)
          loadLesson(flatLessons[currentIndex + 1], {
            target: findBtn(currentIndex + 1),
          });
      };
      function findBtn(i) {
        return document.querySelectorAll(".file-btn")[i];
      }
      menuBtn.onclick = () => sidebar.classList.toggle("hidden");
      reloadBtn.onclick = () => location.reload();
    </script>
  </body>
</html>
